arch: amd64
os: linux
dist: focal # xenial and trusty fail to install PPA (see Dockerfile step-> add-apt-repository ppa:deadsnakes/ppa)
language: python

python:
  - "3.9"

services:
  - docker

git:
  depth: 50

env:
  global:
    - PROJECT_NAME: "turbocommerce"
    - secure: "kFh+fhVrUrpHShGNBGLcKSJlPrdFdIVk0WHLrp/RQL/qz/QmjFR06ng0kvdq8g+4oKxF5WutpZTOqNA3HseQdVTV00hcyYO+iINozLktUEAcVMNBDyAtH4nkfhUqdHwdAe8SftkDDsgEaTd3OrpZDgj8N038WH2iDpjMcWJ0+OWrB9dIRZG53wBIAxP8G0XVAkpJfaQEVBYv79GnfO8ReuA0dhAtm6ki3euosnFFBRATUA1+ccRvVIBWRWmhROVzN7QIxdeM80cBDQJSNRNM8BmDuiCYZvgw6y0yEDqvhqPnjAa0bzN/s0S0IRKGOpLXs7BUHXC62XOphLm/W6rW2vo5QE085ZCDebftI8p8qoWqgKs1vn5xa93qAFBthw/4D0TqYx07tMMyU+HaOeltRvMeBKYOimCdook6ODfyHPQYfIEaxpYLHpVpwoh9GFGknxtIt+jxBfs8DShdzrwn33pJxZiBQoYAKidCUGZt8PgDKO1tYYwLxelPrT1OX+XVk8TkGAoT7j35vUK5tcjcIKfuG/Qe7+N0CgUvlA+/ler2P4T9y2MyvJcNG/7YPTHZnIxAhlxLENzlfnBpXzBQHsRkQNAZxMQnRacL3jS2p7uSRqrdcWY6GVIpza2/2T7kIlG/3BE7ObjbaWOlPbGIVY7PT6W0VnKNeB6wbEP4W4U="
    - REACT_APP_URL: "https://localhost:3000"
    - DEBUG: True
    - secure: "eCDvSz0ojNNoXF90gxTnwiiQ8nm8NZDPiUNIHrr9MJmC2renLo6sa7cpQMR3P+zgsxpXAUEf7ZwU+j971M6QqFN6UjK7ckuAqcv5gNW1GuvcMF2E2rK0KpxeIGKI+Ajo/S0IBHBv9tE4Rpv4qbR5BXF+9qKKjv88VP7Ec08QUutGLtt1RPenzL4dQ16L2pQKf9CjAsBlpKWeqgETa3mzYyj3UYbrwuI2E+S5iKPuMzEFYeE9lDZAZs+Q5e5tMuuo3B6zZgwqzhNg74zAe+b7H8q5Qda+Glwwr+sC/ntOOPpzt/GnpW+MNOklivdq0BLxppaIJ+lGu5Kd7iXC0Mn1U1Su1NFPEsVPtuTtxBWg0CMn4afAL4JqZdfS+gQkALSHAJtzh7zdpcpQzfnAOE+oOqjU4lBDXrn0Ce77Odj5eWUKg7zeeR5b6v2rcNV5jGTxypVtc+WAhfiWSk9Bsvjma3lqehR8kTHdyfXK0nPjkvBr7OsAgH5c6tCe1xkNPowstouizGhazps6l2yc/5iIJ+0J1Q4bnvrsddHYI7qjEO09uvCaNNsBBV0YVKRgOXDrmzEFhPd0vTCaicPcZLGfu1j7Cbc1uWxI68z5dHxPSB5nlR/6PdkGQLvb9CP99tzbg6rDLUdj9LGliczNpDV+9YQCYB+OsgwTu0GI2Icd1gk="
    - secure: "QvYlWDl+dJr8uvSHrSKZTJbOhPt1OaW6HsSHqUQM8dbu9i2i0NMn7ngQeyme0OZPCQLgp+guGyAEwI6tgtuODhXxTdNxJMLya1Ap0hLfK6V/BcOYghCQNzZdUmEHYT+YRFVjBxpDLQ9eN374w0JHlCwbrtv0HWVovbcvFNHqlDH1a5S0aKXthJLF8PvaCrtq9PQPAhXzVdLDvx3vAr0NNwLS8Ej21d6yJXaUZpxbO5FjAn050WkBG1XToaVZ4e8eJuxYtB7cbJnuQG+TAgAB1bK6Wnt/qBU3KWv/MTRaLkbueolfbXB17KXLWPZ3cn5rRLyvCHgQPCUYbL6PzXDkZmgMqanAkEUDcwH74cP8vHz/D/jtbZLOWjkdx1HzmdrSyNdEb0rKf5ro/NIyRSpWZMzz4q7Uzf9GZDH31Lyofkpc/XlHVSkcnEPMOODs2FzTzpJGRoPIuFy4z5dO0LON96J0Or0brR5hmXsaFZqMLfa5Cs6l5LlLZ/Knf3pr6kMoCRZTH5b53FjyRF9Pi1GUpTb0IFtc0s/JpYIYgJcP2qO6z53s5g0Dd4ERbM82T7LsopHSZH/PCDYYViKZ5kioXqn6HCbV3i9ladGv5DAW8yJyxHKneEPbiqE5pj+6drF3YPiqYwUUTR8RdOXSNZ9cE23KQTPfJI09aXk3edqSpX8="
    - secure: "YsKF/PCXDYwBloYgxtNiW3QtH9lc0UmLRcLAENQkdPYialeCKxPd8end+C2Pqu8hE0dC4ScXsTngwSixZNd2gYuTkxUtfbm55nmCzjYeZgM4n1cNTM1RhMNFM98ietGgtQrKfE315GEuTGHKxwiWBcfqcpAkoSzvxqm3fTeowLTaX6+GxBxd8Cv2EVw22k+u48PBrrB0W/YAnia/cETWSauuYylJqDxVDA6JPjqh+D6MV0IEBxtWOun3P9AL8ZaBWVsf8hrVrI9cnQawDC0uUkpharJk9svtAgoJmIc9jC6lbKMHVDZGDz74Vykmss/dbC7X/4JaB7ho4BgavbhhtdB+Cs7YaeEGIrWJ68VMocscu0jEywv3o3qHczG3DhnIakblfUBsnVkRRavA7zvU1Gq/LX69YWTpUmuGnRQR1tlb5AaCXrGzGAxhBEgA087QbcyAel+yUUgSiJIdCvABaWkFDn72EShROo/Mv5N9qo3wVB0k8baIitLYNGZ4c9L553uW2uv0L84OeqTqOCeBgHP2kw+q9lCysHGMt9Tg3SwHELt0ZppiY82FAGMu9tZzIRzbRn1h9kyq4/D2+lNs12Xq0612ldB4aM/nmcXTYs3KAQwzVzJuxfvtg3wPveZM8rWFp7okQsQecCdtE8W9IQTNsg4LH8cJux7zwG54x4Q="
    - REST_FRAMEWORK_PAGE_SIZE: 10
    - REST_FRAMEWORK_MAX_PAGE_SIZE: 1000
    - secure: "DBqtKEu3YQsdt5oLG7nrzxHjorECgjjztUU/Mlpe6wCW+d0FohYQgBHhXd6pszla/AeJ0ns0vXcEinbl3Kx8fZFTxTrhWds73TXi+XQANLggxhYcIPVe9CL72dYtdp9rldOoHLCu/ME9RN0KSMkh4K1XRx7YIgEOaDzYnXkRwoLQDAo+yxQXnnEBpWhjazBDNSGPX8r/wWPoZCQbi6GXy9k8as9jCwAw9G53GTPHjRKbrJDnX4kj0pb5b6sgAmZ8J9XRhfRtXMhIw+WZdFrL7sKJS5jAw4jFJ03t3yi12h8DIqlQe1w+QqOKvoiXlqwYnSRLc1pwkoUFJg67e4Ftb9OeWi2gdPg8qex20y5qLCZrIrY+rU/Lurdc9xhLtY4e41xPayGgnAZb2odTiX7gm6IfwMf9iX0MunNo3ibITERwKhjrNwqv1GjNVtF/l1PaFx+TtbQVEzRW7OOx4NbjAowDbn85+MQz2z4YbkYqrPWsgDC5mo0W3tn0mnpkbKDIIbINkOea465se2iTVvk/WIK9VHLylMWOIKxJ+p4PF6MiRas8WVvO2U84nSkkMEbYlMZIRyD3kZRMt8aeGwl39TCzk7BI4sja2Egj6h1T8HWZEkbIxFNv7Lc1a+FKi8X2k6ZfuiCNtMRTCZ8ZH14HmXlCpDjLIZtb80fvJnhmQV4="
    - secure: "F94uWMNMGB20c7Q0CZ0FZMgaLHURg92wmEwn7PGP3oDek6eUNXZBrxe8EKq5wyn4B3Ynf1VWzUecImYaScWm2mueYu7PIPQff+F+xRnZjg5r1c+fC2IdytjyK2y6lFkKStKE6ROTXQNjjZbtRI1DKDbJfnooUQoERhKg8stfBq0v+RgE9PIkpJiX6n17gGhT6k9kWPKGTNcu12PJkyCTBd5MTEYoZGhLjCwEL0ZwJdqsqLy4UCiZpA3OXFtglw1D5p0MI3Aa5O+6PS9POIw/lT7n0ueDqpUIGnxeLto1jr7Lm+T1JuFtcGYQ/oRCoLWofl5RMyPzkmSGHVcGbr0pkIAPrxjcgX0G8/3b7UFYnyc+796yt0gAEBilFapp5aYGor6cBVl1wjt/wQsdsgh5GLPnJ0s5I+XZqJFh4qQtjQWVUBrnC/2C7kfJLcSEdWXT8EEKMfzbp0fkZLcjyqpEhV1nvn6Oh7GenMKw+zuDC4eMz3xNgUb44ldy7uRXEfhkR9xzZp6rmu2Q2JNVBTA/9XmEbHS3l0gk8X/tQLuyWZBdZm040egBD+hGAtcTmKPMB8hs+UvqY5vOiQJA/lKaHdAHXIkIoAANQ03lxiDciYmz8Vyx6W/zx6KbN37lViuDAXJsVmQf5ScYeLnCfbFJF+uPtpf4LqKUkx3olf05ZlU="
    - secure: "MmeOqFoDLDVLUmTSSesEDX78SrukhhsYZXZZu9YK+EG/jtCwvsRbwUoq56nNdRMaFlYfvkBN1Vq4g1GwEW7yN4NyquqPY+y/3SaVt2cQ9OC+J1bUoVHb/Lgr+8GZbVv8ekybItin5LqvseD7L1ckyotSqKtJa/wv3nsI7bZwDlAfzeA+CN2bumN7AkFZWXHTROmKzWEdpU7+jVJ6SHh6jStqzB6qan/l/t1Tzp/1DRJm8H6Dk7ZdiidjdhHkqzLsj/0B2JoswqtBf9AIUzN9TWDz+YKk6t0L34Hf6XIq/FgW9LhIm8vF08UsJICg3gYs6qXiWXzITU3OY3lEeR6bDNTdLZrQltV4kopgg5PLFwI+YUaQGxuYABnYSzNAejLdHEGf+JDdxv1bzMXU5Ij6rrXm4nIEJzVjqZ3i8AD3ivcRxD2A4hw3hbLG/5TSX1GJvprRU3FYuXb1vdGlzu4OfX/ieVcjHOlSDp+IqTMXXdXqRdrt6+Ge3tQzuUXz1LTS3i+fonp4eJkZ+TLvWtIeVqB1Jpgp1o+4MFygQjJTSprODqY2sr5KiHLmGoWUY3BTK0eaKpFnO95uh4lb5arSMoaSqeK7TclPgm97hkUkhXLXbA9eQyIgWbMep/iwTdwZQKhYYzeyyD4E2YlgyCGLjUDPZt1wOuOJc25oHYinyj0="
    - POSTGRES_HOST: "turbocommerce_db"
    - POSTGRES_PORT: 5432

cache:
  - pip

before_install:
  - chmod +x $HOME
  - chown -R travis $HOME
  - bash ./travis/make_env_file.sh
  - curl -L https://github.com/docker/compose/releases/download/1.29.2/docker-compose-`uname -s`-`uname -m` > ~/docker-compose
  - chmod +x ~/docker-compose
  - sudo mv ~/docker-compose /usr/local/bin/docker-compose
  - docker-compose run -d turbocommerce_db
  - whoami
  - chown -R travis $HOME
  - docker-compose build turbocommerce_backend

script:
  - docker-compose run turbocommerce_backend bash ./run_backend_tests.sh
